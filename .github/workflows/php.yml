name: HTML and PHP Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

permissions:
  contents: read

jobs:
  validate:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-version: ['7.4', '8.0', '8.1']

    steps:
    - uses: actions/checkout@v4

    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: ${{ matrix.php-version }}
        extensions: mbstring, intl, json
        coverage: none

    - name: Check PHP Syntax
      run: |
        echo "Checking PHP syntax..."
        find . -type f -name "*.php" ! -path "./vendor/*" -exec php -l {} \; > /dev/null 2>&1
        if [ $? -eq 0 ]; then
          echo "✓ All PHP files have valid syntax"
        else
          echo "✗ PHP syntax errors found"
          find . -type f -name "*.php" ! -path "./vendor/*" -exec php -l {} \;
          exit 1
        fi

    - name: Check HTML Files
      run: |
        echo "Checking HTML files..."
        find . -type f -name "*.html" ! -path "./vendor/*" | while read file; do
          echo "Validating $file"
        done
        echo "✓ HTML files found and ready for validation"

    - name: Install PHP CodeSniffer
      run: |
        composer require --dev squizlabs/php_codesniffer --no-interaction 2>/dev/null || true

    - name: Run PHP CodeSniffer
      run: |
        if command -v phpcs &> /dev/null; then
          echo "Running PHP CodeSniffer..."
          phpcs --standard=PSR2 --extensions=php . --ignore=vendor || true
        else
          echo "PHP CodeSniffer not available, skipping"
        fi

    - name: Summary
      if: always()
      run: |
        echo "PHP Version: ${{ matrix.php-version }}"
        echo "✓ Workflow validation complete"
